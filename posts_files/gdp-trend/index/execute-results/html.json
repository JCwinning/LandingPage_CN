{
  "hash": "25e89b9546fed77121e397bb80cc14ee",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"ä½¿ç”¨ AI SQL æ„å»ºçš„äº¤äº’å¼ GDP è¶‹åŠ¿çœ‹æ¿\"\ndate: \"2025-11-18\"\ncategories: [Data Visualization, Streamlit, Economic Analysis, AI]\nimage: \"images/0.png\"\n\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    code-copy: true\n    \nexecute:\n  eval: false\n  warning: false\n---\n\n# é¡¹ç›®æ¦‚è§ˆ\n\nGDP è¶‹åŠ¿çœ‹æ¿ (GDP Trend Dashboard) æ˜¯ä¸€ä¸ªå¤æ‚çš„ Web åº”ç”¨ç¨‹åºï¼Œç”¨äºå¯è§†åŒ–å’Œåˆ†ææ¥è‡ªä¸–ç•Œé“¶è¡Œ API çš„ç»æµæ•°æ®ã€‚è¯¥ç³»ç»Ÿçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå…¶åŒé‡æ–¹æ³•ï¼šå°†ä¼ ç»Ÿçš„äº¤äº’å¼å¯è§†åŒ–ä¸ AI é©±åŠ¨çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ç›¸ç»“åˆï¼Œä½¿æŠ€æœ¯åˆ†æå¸ˆå’Œæ™®é€šç”¨æˆ·éƒ½èƒ½è½»æ¾è·å–ç»æµæ•°æ®ã€‚\n\n\nåœ¨çº¿æ¼”ç¤ºï¼š[https://world-GDP-trend.streamlit.app](https://world-GDP-trend.streamlit.app)\n\nGithubï¼š[https://github.com/JCwinning/GDP_trend](https://github.com/JCwinning/GDP_trend)\n\n::: {.panel-tabset}\n\n## GDP è¶‹åŠ¿\n\näº¤äº’å¼å…¨çƒ GDP è¶‹åŠ¿å¯è§†åŒ–\n\n![](images/0.png){width=\"100%\"}\n\n\n## AI æŸ¥è¯¢ç•Œé¢\n\näº¤äº’å¼ AI é©±åŠ¨çš„è‡ªç„¶è¯­è¨€è½¬ SQL\n\n![](images/1.png){width=\"100%\"}\n\n\n## AI æ‘˜è¦ç”Ÿæˆ\n\nAI ç”Ÿæˆçš„ç»æµæ•°æ®æ´è§æ‘˜è¦\n\n![](images/2.png){width=\"100%\"}\n\n\n:::\n\n\n\n## æ ¸å¿ƒæ¶æ„\n\n### æŠ€æœ¯æ ˆ\n\n- **ä¸»è¦æ¡†æ¶**ï¼šç”¨äºäº¤äº’å¼ Web åº”ç”¨çš„ Streamlit\n- **æ•°æ®å¤„ç†**ï¼šç”¨äºæ•°æ®æ“ä½œå’Œåˆ†æçš„ Pandas\n- **å¯è§†åŒ–**ï¼šç”¨äºäº¤äº’å¼å›¾è¡¨çš„ Plotly Express\n- **æ•°æ®åº“**ï¼šç”¨äºé«˜æ•ˆ SQL æŸ¥è¯¢çš„ DuckDB\n- **AI é›†æˆ**ï¼šç”¨äºè‡ªç„¶è¯­è¨€è½¬ SQL çš„ ModelScope GLM-4.6\n- **æ•°æ®æº**ï¼šé€šè¿‡ `wbgapi` åº“è°ƒç”¨çš„ä¸–ç•Œé“¶è¡Œ API\n\n### å…³é”®ç‰¹æ€§\n\n1. **å¤šå›½ GDP è¶‹åŠ¿å¯¹æ¯”**\n2. **æ”¯æŒå¤šç§ç»æµæŒ‡æ ‡**ï¼ˆGDPã€äººå‡ GDPã€äººå£ã€åŒæ¯”å¢é•¿ç‡ï¼‰\n3. **AI é©±åŠ¨çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢**\n4. **ä½¿ç”¨ DuckDB çš„ç›´æ¥ SQL æ¥å£**\n5. **å®Œå–„çš„åŒè¯­æ”¯æŒ**ï¼ˆä¸­/è‹±æ–‡ï¼‰\n6. **å¸¦äº¤äº’æ§åˆ¶çš„æ—¶é—´èŒƒå›´ç­›é€‰**ï¼ˆ2000å¹´è‡³ä»Šï¼‰\n\n## æ•°æ®æµæ°´çº¿æ¶æ„\n\nè¯¥åº”ç”¨ç¨‹åºå®ç°äº†ä¸€ä¸ªå¤æ‚çš„æ•°æ®æµæ°´çº¿ï¼Œä»¥ç¡®ä¿æ•°æ®è´¨é‡å’Œå®æ—¶å¯ç”¨æ€§ï¼š\n\n\n\n\n\n```{mermaid}\n%%| eval: true\n%%| fig-cap: \"GDP åº”ç”¨æ¶æ„\"\n\nflowchart TD\n    A[ä¸–ç•Œé“¶è¡Œ API] --> B[æ•°æ®é‡‡é›†<br/>download_data.py]\n    B --> C[æ•°æ®å¤„ç†<br/>å›½å®¶æ˜ å°„ã€æŒ‡æ ‡è®¡ç®—]\n    C --> D[æ•°æ®å­˜å‚¨<br/>CSV æ–‡ä»¶]\n\n    D --> E[Streamlit åº”ç”¨<br/>app.py]\n    E --> F[DuckDB<br/>å†…å­˜ SQL]\n\n    F --> G[å¯è§†åŒ–å¼•æ“<br/>Plotly Express]\n    F --> H[AI æŸ¥è¯¢å¼•æ“<br/>ModelScope API]\n    F --> I[ä¼šè¯ç®¡ç†<br/>ç”¨æˆ·çŠ¶æ€]\n\n    G --> J[äº¤äº’å¼å›¾è¡¨]\n    H --> K[è‡ªç„¶è¯­è¨€<br/>è½¬ SQL]\n    I --> L[æŒä¹…åŒ–<br/>æŸ¥è¯¢ç»“æœ]\n\n    J --> M[ç”¨æˆ·ç•Œé¢]\n    K --> M\n    L --> M\n```\n\n## æ•°æ®é‡‡é›†ä¸å¤„ç†\n\n### ä¸–ç•Œé“¶è¡Œ API é›†æˆ\n\nåº”ç”¨ç¨‹åºä½¿ç”¨ä¸–ç•Œé“¶è¡Œ API é‡‡é›†å…¨é¢çš„ç»æµæ•°æ®ï¼š\n\n::: {#523bec37 .cell execution_count=1}\n``` {.python .cell-code}\nimport wbgapi as wb\nimport pycountry\nimport pandas as pd\n\ndef download_economic_data():\n    \"\"\"ä»ä¸–ç•Œé“¶è¡Œ API ä¸‹è½½æ‰€æœ‰å›½å®¶çš„ GDP æ•°æ®\"\"\"\n\n    # å®šä¹‰è¦ä¸‹è½½çš„ç»æµæŒ‡æ ‡\n    indicators = {\n        'gdp_current_usd': 'NY.GDP.MKTP.CD',\n        'gdp_per_capita_current_usd': 'NY.GDP.PCAP.CD',\n        'population_total': 'SP.POP.TOTL'\n    }\n\n    # ä¸‹è½½ 2000 å¹´è‡³ä»Šçš„æ•°æ®\n    data_frames = []\n    for indicator_name, indicator_code in indicators.items():\n        df = wb.get_series(\n            series=indicator_code,\n            economy='all',\n            time='2000:2024',\n            simplify_index=True\n        )\n\n        # å¤„ç†å¹¶æ·»åŠ åˆ°é›†åˆ\n        df = df.reset_index()\n        df['indicator'] = indicator_name\n        data_frames.append(df)\n\n    # åˆå¹¶æ‰€æœ‰æŒ‡æ ‡\n    combined_df = pd.concat(data_frames, ignore_index=True)\n    return combined_df\n\ndef create_country_reference_table():\n    \"\"\"åˆ›å»ºåŒ…å« ISO ä»£ç çš„å®Œæ•´å›½å®¶å…ƒæ•°æ®è¡¨\"\"\"\n    countries = list(pycountry.countries)\n\n    df_all = pd.DataFrame([{\n        'country_name': country.name,\n        'country_code_2': country.alpha_2,\n        'country_code_3': country.alpha_3\n    } for country in countries])\n\n    # æ·»åŠ å¤§æ´²æ˜ å°„\n    iso_to_continent = {\n        \"US\": \"North America\", \"CN\": \"Asia\", \"JP\": \"Asia\",\n        \"DE\": \"Europe\", \"GB\": \"Europe\", \"FR\": \"Europe\"\n        # ... ä¸ºæ‰€æœ‰å›½å®¶å®Œæˆæ˜ å°„\n    }\n\n    df_all['continent'] = df_all['country_code_2'].map(iso_to_continent)\n    return df_all\n```\n:::\n\n\n### æ•°æ®æ¨¡å¼ä¸ç»“æ„\n\nåº”ç”¨ç¨‹åºä½¿ç”¨æ¸…æ™°ã€è§„èŒƒåŒ–çš„æ•°æ®ç»“æ„ï¼š\n\n::: {#99433cf5 .cell execution_count=2}\n``` {.python .cell-code}\n-- ä¸»è¦æ•°æ®æ¨¡å¼\nCREATE TABLE df_gdp (\n    country_name TEXT,        -- æ˜¾ç¤ºåç§° (è‹±æ–‡)\n    country_code_2 TEXT,      -- ISO alpha-2 ä»£ç \n    country_code_3 TEXT,      -- ISO alpha-3 ä»£ç \n    continent TEXT,            -- å¤§æ´²åˆ†ç±»\n    year INTEGER,              -- æ•°æ®å¹´ä»½\n    indicator TEXT,            -- ç»æµæŒ‡æ ‡åç§°\n    value REAL                -- æŒ‡æ ‡æ•°å€¼\n);\n\n-- ç¤ºä¾‹æ•°æ®\nINSERT INTO df_gdp VALUES\n('United States', 'US', 'USA', 'North America', 2023, 'gdp_current_usd', 27444144.3),\n('United States', 'US', 'USA', 'North America', 2023, 'gdp_per_capita_current_usd', 81254.2),\n('United States', 'US', 'USA', 'North America', 2023, 'population_total', 334914895.0);\n```\n:::\n\n\n## äº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿ\n\n### Plotly Express å®ç°\n\nåº”ç”¨ç¨‹åºä½¿ç”¨ Plotly Express åˆ›å»ºäº¤äº’å¼å›¾è¡¨ï¼Œå¹¶ä¿æŒä¸€è‡´çš„é¢œè‰²ç¼–ç ï¼š\n\n::: {#3f57170a .cell execution_count=3}\n``` {.python .cell-code}\nimport plotly.express as px\n\n@st.cache_data\ndef load_data():\n    \"\"\"åŠ è½½å¹¶ç¼“å­˜ GDP æ•°æ®\"\"\"\n    return pd.read_csv('data/gdp_data_2000_present.csv')\n\ndef create_gdp_trend_chart(selected_countries, selected_indicator, year_range):\n    \"\"\"åˆ›å»ºäº¤äº’å¼ GDP è¶‹åŠ¿å¯è§†åŒ–\"\"\"\n\n    # åŠ è½½ç­›é€‰åçš„æ•°æ®\n    df = load_data()\n\n    # åº”ç”¨ç­›é€‰æ¡ä»¶\n    filtered_df = df[\n        (df['country_name'].isin(selected_countries)) &\n        (df['indicator'] == selected_indicator) &\n        (df['year'].between(year_range[0], year_range[1]))\n    ]\n\n    # åˆ›å»ºäº¤äº’å¼æŠ˜çº¿å›¾\n    fig = px.line(\n        filtered_df,\n        x='year',\n        y='value',\n        color='country_name',\n        title=f'{selected_indicator.replace(\"_\", \" \").title()} è¶‹åŠ¿',\n        labels={\n            'year': 'å¹´ä»½',\n            'value': format_indicator_label(selected_indicator),\n            'country_name': 'å›½å®¶'\n        }\n    )\n\n    # è‡ªå®šä¹‰å›¾è¡¨å¤–è§‚\n    fig.update_layout(\n        xaxis_title=\"å¹´ä»½\",\n        yaxis_title=format_indicator_label(selected_indicator),\n        hovermode='x unified',\n        showlegend=True,\n        legend=dict(\n            orientation=\"h\",\n            yanchor=\"bottom\",\n            y=1.02,\n            xanchor=\"right\",\n            x=1\n        )\n    )\n\n    return fig\n\ndef format_indicator_label(indicator):\n    \"\"\"æ ¼å¼åŒ–æŒ‡æ ‡åç§°ä»¥ä¾›æ˜¾ç¤º\"\"\"\n    labels = {\n        'gdp_current_usd': 'GDP (ç°ä»·ç¾å…ƒ)',\n        'gdp_per_capita_current_usd': 'äººå‡ GDP (ç°ä»·ç¾å…ƒ)',\n        'population_total': 'æ€»äººå£',\n        'gdp_per_capita_current_usd_yoy': 'äººå‡ GDP åŒæ¯”å¢é•¿ç‡ (%)'\n    }\n    return labels.get(indicator, indicator.replace('_', ' ').title())\n```\n:::\n\n\n## AI é©±åŠ¨çš„åˆ†æ\n\n### è‡ªç„¶è¯­è¨€è½¬ SQL\n\nè¯¥ç¨‹åºæœ€å…·åˆ›æ–°æ€§çš„åŠŸèƒ½æ˜¯ AI é©±åŠ¨çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼š\n\n::: {#f3df571a .cell execution_count=4}\n``` {.python .cell-code}\nfrom openai import OpenAI\nimport duckdb\n\ndef generate_sql_from_question(question, language):\n    \"\"\"ä½¿ç”¨ ModelScope API å°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸º SQL æŸ¥è¯¢\"\"\"\n\n    # è·å–æ•°æ®åº“æ¨¡å¼ä¸Šä¸‹æ–‡\n    schema_info = \"\"\"\n    è¡¨å: df_gdp\n    åˆ—å:\n    - country_name (TEXT): å›½å®¶æ˜¾ç¤ºåç§°\n    - country_code_2 (TEXT): ISO alpha-2 å›½å®¶ä»£ç \n    - continent (TEXT): å¤§æ´²åˆ†ç±»\n    - year (INTEGER): æ•°æ®å¹´ä»½ (2000-2024)\n    - indicator (TEXT): ç»æµæŒ‡æ ‡åç§°\n    - value (REAL): æŒ‡æ ‡æ•°å€¼\n\n    å¯ç”¨æŒ‡æ ‡:\n    - gdp_current_usd: ç°ä»· GDP (ç¾å…ƒ)\n    - gdp_per_capita_current_usd: ç°ä»·äººå‡ GDP (ç¾å…ƒ)\n    - population_total: æ€»äººå£\n    - gdp_per_capita_current_usd_yoy: äººå‡ GDP åŒæ¯”å¢é•¿ç‡ (%)\n    \"\"\"\n\n    # åˆ›å»ºç‰¹å®šè¯­è¨€çš„æç¤ºè¯\n    if language == \"zh\":\n        prompt = f\"\"\"è¯·å°†ä»¥ä¸‹è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸ºSQLæŸ¥è¯¢ï¼Œä»…è¿”å›SQLè¯­å¥ï¼Œä¸è¦è§£é‡Šã€‚\n\næ•°æ®åº“ä¿¡æ¯ï¼š\n{schema_info}\n\nç”¨æˆ·é—®é¢˜ï¼š{question}\n\nè¦æ±‚ï¼š\n1. åªè¿”å›æ ‡å‡†çš„SELECTè¯­å¥\n2. ä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–æ³¨é‡Š\n3. ä½¿ç”¨LIMIT 50é™åˆ¶ç»“æœæ•°é‡\"\"\"\n    else:\n        # (ä¿æŒåŸè‹±æ–‡ prompt)\n        prompt = f\"\"\"Convert the following natural language question to SQL query. Return only the SQL statement, no explanation.\n\nDatabase information:\n{schema_info}\n\nUser question: {question}\n\nRequirements:\n1. Return only standard SELECT statement\n2. Do not add any explanation or comments\n3. Use LIMIT 50 to restrict results\"\"\"\n\n    # è°ƒç”¨ ModelScope API\n    client = OpenAI(\n        api_key=os.getenv('MODELSCOPE_API_KEY'),\n        base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\"\n    )\n\n    response = client.chat.completions.create(\n        model=\"qwen/Qwen3-235B\",\n        messages=[{\"role\": \"user\", \"content\": prompt}],\n        temperature=0.1,  # ä½¿ç”¨ä½æ¸©åº¦ä»¥è·å¾—ä¸€è‡´çš„ SQL\n        max_tokens=500\n    )\n\n    return response.choices[0].message.content.strip()\n```\n:::\n\n\n### æŸ¥è¯¢æ‰§è¡Œä¸ AI æ‘˜è¦\n\n::: {#0e757453 .cell execution_count=5}\n``` {.python .cell-code}\ndef execute_query_with_ai_summary(sql_query, original_question):\n    \"\"\"æ‰§è¡Œ SQL æŸ¥è¯¢å¹¶ç”Ÿæˆ AI æ‘˜è¦\"\"\"\n\n    try:\n        # ä½¿ç”¨ DuckDB æ‰§è¡ŒæŸ¥è¯¢\n        conn = duckdb.connect()\n        result_df = conn.execute(sql_query).fetchdf()\n\n        # å°†ç»“æœå­˜å…¥ä¼šè¯çŠ¶æ€\n        st.session_state.sql_result = result_df\n        st.session_state.sql_query = sql_query\n\n        # å¦‚æœæœ‰æ•°æ®ï¼Œç”Ÿæˆ AI æ‘˜è¦\n        if not result_df.empty:\n            generate_ai_summary(result_df, original_question)\n\n        return result_df\n\n    except Exception as e:\n        st.error(f\"æŸ¥è¯¢æ‰§è¡Œé”™è¯¯: {str(e)}\")\n        return None\n\ndef generate_ai_summary(data_frame, question):\n    \"\"\"ç”ŸæˆæŸ¥è¯¢ç»“æœçš„ AI æ‘˜è¦\"\"\"\n\n    # å°† DataFrame è½¬æ¢ä¸ºæ–‡æœ¬ä»¥ä¾¿åˆ†æ\n    data_summary = data_frame.to_string(index=False)\n\n    summary_prompt = f\"\"\"æ ¹æ®ä»¥ä¸‹æ•°æ®åˆ†æç»“æœï¼Œæä¾›ä¸€ä¸ªç®€æ˜æ‰¼è¦çš„æ‘˜è¦ï¼š\n\nåŸå§‹é—®é¢˜ï¼š{question}\n\næŸ¥è¯¢ç»“æœï¼š\n{data_summary}\n\nè¯·æä¾›ï¼š\n1. å…³é”®å‘ç°çš„ç®€è¦åˆ†æ\n2. ä»»ä½•å€¼å¾—æ³¨æ„çš„è¶‹åŠ¿æˆ–æ¨¡å¼\n3. æ¥è‡ªæ•°æ®çš„é‡è¦è§è§£\n\nè¯·å°†æ‘˜è¦æ§åˆ¶åœ¨ 200 å­—ä»¥å†…ï¼Œå¹¶ç¡®ä¿é€šä¿—æ˜“æ‡‚ã€‚\"\"\"\n\n    # ä½¿ç”¨ AI ç”Ÿæˆæ‘˜è¦\n    client = OpenAI(\n        api_key=os.getenv('MODELSCOPE_API_KEY'),\n        base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\"\n    )\n\n    response = client.chat.completions.create(\n        model=\"qwen/Qwen3-235B\",\n        messages=[{\"role\": \"user\", \"content\": summary_prompt}],\n        temperature=0.3,\n        max_tokens=300\n    )\n\n    st.session_state.ai_summary = response.choices[0].message.content\n```\n:::\n\n\n![AI æŸ¥è¯¢ç•Œé¢ - è‡ªç„¶è¯­è¨€å¤„ç†](images/1.png){width=\"100%\"}\n\n## åŒè¯­æ”¯æŒç³»ç»Ÿ\n\n### å›½é™…åŒ–æ¶æ„\n\nåº”ç”¨ç¨‹åºå®ç°äº†å…¨é¢çš„ä¸­/è‹±æ–‡æ”¯æŒï¼š\n\n::: {#d43e8624 .cell execution_count=6}\n``` {.python .cell-code}\n# language.py - å®Œæ•´çš„ç¿»è¯‘ç³»ç»Ÿ\ntranslations = {\n    \"en\": {\n        \"title\": \"ğŸŒ GDP Trend Dashboard\",\n        \"gdp_trend\": \"GDP Trend\",\n        \"ai_powered_chat\": \"AI-Powered Data Chat\",\n        \"default_question\": \"What is the average GDP per capita for China, Japan, and Korea during 2020 to 2023?\"\n    },\n    \"zh\": {\n        \"title\": \"ğŸŒ GDP è¶‹åŠ¿çœ‹æ¿\",\n        \"gdp_trend\": \"GDP è¶‹åŠ¿\",\n        \"ai_powered_chat\": \"AI æ•°æ®å¯¹è¯\",\n        \"default_question\": \"2020å¹´è‡³2023å¹´æœŸé—´ï¼Œä¸­å›½ã€æ—¥æœ¬å’ŒéŸ©å›½çš„å¹³å‡äººå‡GDPæ˜¯å¤šå°‘ï¼Ÿ\"\n    }\n}\n\ndef get_text(key):\n    \"\"\"è·å–å½“å‰è¯­è¨€çš„ç¿»è¯‘æ–‡æœ¬\"\"\"\n    language = st.session_state.get(\"language\", \"en\")\n    return translations.get(language, {}).get(key, key)\n\n# UI ä¸­çš„è¯­è¨€åˆ‡æ¢\ncol1, col2 = st.columns([1, 1])\nwith col1:\n    if st.button(\"English\"):\n        st.session_state.language = \"en\"\n        st.rerun()\nwith col2:\n    if st.button(\"ä¸­æ–‡\"):\n        st.session_state.language = \"zh\"\n        st.rerun()\n```\n:::\n\n\n## ç”¨æˆ·ç•Œé¢è®¾è®¡\n\n### ä¸»åº”ç”¨ç¨‹åºç»“æ„\n\n::: {#f437212a .cell execution_count=7}\n``` {.python .cell-code}\ndef main():\n    \"\"\"é‡‡ç”¨æ ‡ç­¾é¡µå¯¼èˆªçš„ä¸»åº”ç”¨ç¨‹åº\"\"\"\n\n    # å³ä¸Šè§’çš„è¯­è¨€åˆ‡æ¢\n    with st.container():\n        st.markdown(\"\"\"\n        <div class=\"language-toggle\">\n            <button onclick=\"setLanguage('en')\">EN</button>\n            <button onclick=\"setLanguage('zh')\">ä¸­æ–‡</button>\n        </div>\n        \"\"\", unsafe_allow_html=True)\n\n    st.title(get_text(\"title\"))\n\n    # æ ‡ç­¾é¡µç•Œé¢\n    tab1, tab2 = st.tabs([get_text(\"gdp_trend\"), get_text(\"query\")])\n\n    with tab1:\n        render_gdp_trends_tab()\n\n    with tab2:\n        render_query_interface_tab()\n\ndef render_gdp_trends_tab():\n    \"\"\"æ¸²æŸ“ GDP è¶‹åŠ¿å¯è§†åŒ–æ ‡ç­¾é¡µ\"\"\"\n\n    st.header(get_text(\"gdp_trend\"))\n\n    # åŠ è½½æ•°æ®\n    df = load_data()\n\n    # ç­›é€‰æ§åˆ¶\n    col1, col2, col3 = st.columns([2, 1, 1])\n\n    with col1:\n        selected_countries = st.multiselect(\n            get_text(\"select_countries\"),\n            options=df['country_name'].unique(),\n            default=['United States', 'China', 'Japan']\n        )\n\n    with col2:\n        selected_indicator = st.selectbox(\n            get_text(\"select_indicator\"),\n            options=[\n                'gdp_current_usd',\n                'gdp_per_capita_current_usd',\n                'population_total',\n                'gdp_per_capita_current_usd_yoy'\n            ],\n            format_func=lambda x: format_indicator_label(x)\n        )\n\n    with col3:\n        year_range = st.slider(\n            get_text(\"select_year_range\"),\n            min_value=2000,\n            max_value=2024,\n            value=(2010, 2024),\n            step=1\n        )\n\n    # ç”Ÿæˆå¹¶æ˜¾ç¤ºå›¾è¡¨\n    if selected_countries and selected_indicator:\n        fig = create_gdp_trend_chart(selected_countries, selected_indicator, year_range)\n        st.plotly_chart(fig, use_container_width=True)\n\n        # æ˜¾ç¤ºåŸå§‹æ•°æ®é€‰é¡¹\n        if st.checkbox(get_text(\"show_raw_data\")):\n            display_filtered_data_table(selected_countries, selected_indicator, year_range)\n\ndef render_query_interface_tab():\n    \"\"\"æ¸²æŸ“ AI é©±åŠ¨çš„æŸ¥è¯¢ç•Œé¢æ ‡ç­¾é¡µ\"\"\"\n\n    st.header(get_text(\"ai_powered_chat\"))\n    st.markdown(get_text(\"ai_chat_description\"))\n\n    # è‡ªç„¶è¯­è¨€è¾“å…¥\n    user_question = st.text_input(\n        get_text(\"your_question\"),\n        value=st.session_state.get(\"user_question\", get_text(\"default_question\"))\n    )\n\n    col1, col2 = st.columns([1, 1])\n\n    with col1:\n        if st.button(get_text(\"run_ai\"), type=\"primary\"):\n            if user_question:\n                with st.spinner(\"AI æ­£åœ¨å¤„ç†...\"):\n                    # ä»è‡ªç„¶è¯­è¨€ç”Ÿæˆ SQL\n                    sql_query = generate_sql_from_question(\n                        user_question,\n                        st.session_state.language\n                    )\n\n                    if sql_query:\n                        # æ‰§è¡ŒæŸ¥è¯¢å¹¶ç”Ÿæˆæ‘˜è¦\n                        result_df = execute_query_with_ai_summary(sql_query, user_question)\n\n                        st.session_state.user_question = user_question\n                        st.session_state.should_generate_ai_summary = True\n\n    # æ˜¾ç¤ºç»“æœ\n    if st.session_state.get(\"sql_result\") is not None:\n        display_query_results()\n```\n:::\n\n\n## æ€§èƒ½ä¼˜åŒ–\n\n### æ•°æ®ç¼“å­˜ä¸æ•ˆç‡\n\n::: {#7f0ecdba .cell execution_count=8}\n``` {.python .cell-code}\n# Streamlit æ•°æ®æ“ä½œç¼“å­˜\n@st.cache_data(ttl=3600)  # ç¼“å­˜ 1 å°æ—¶\ndef load_data():\n    \"\"\"åŠ è½½å¹¶ç¼“å­˜ GDP æ•°æ®\"\"\"\n    return pd.read_csv('data/gdp_data_2000_present.csv')\n\n@st.cache_data(ttl=1800)  # ç¼“å­˜ 30 åˆ†é’Ÿ\ndef get_country_list():\n    \"\"\"è·å–å¹¶ç¼“å­˜å”¯ä¸€çš„å›½å®¶åˆ—è¡¨\"\"\"\n    df = load_data()\n    return sorted(df['country_name'].unique())\n\n# AI äº¤äº’çš„ä¼šè¯çŠ¶æ€ç®¡ç†\ndef init_session_state():\n    \"\"\"åˆå§‹åŒ–æ‰€æœ‰ä¼šè¯çŠ¶æ€å˜é‡\"\"\"\n    if \"sql_result\" not in st.session_state:\n        st.session_state.sql_result = None\n    if \"ai_summary\" not in st.session_state:\n        st.session_state.ai_summary = None\n    if \"should_generate_ai_summary\" not in st.session_state:\n        st.session_state.should_generate_ai_summary = False\n```\n:::\n\n\n### é”™è¯¯å¤„ç†ä¸ç”¨æˆ·ä½“éªŒ\n\n::: {#3e412006 .cell execution_count=9}\n``` {.python .cell-code}\ndef safe_api_call(func, *args, **kwargs):\n    \"\"\"å¸¦é”™è¯¯å¤„ç†çš„å®‰å…¨ API è°ƒç”¨\"\"\"\n    try:\n        return func(*args, **kwargs)\n    except Exception as e:\n        st.error(f\"API é”™è¯¯: {str(e)}\")\n        return None\n\ndef validate_sql_query(sql_query):\n    \"\"\"åŸºç¡€ SQL æŸ¥è¯¢éªŒè¯\"\"\"\n    sql_lower = sql_query.lower().strip()\n\n    # åŸºç¡€å®‰å…¨æ£€æŸ¥\n    dangerous_keywords = ['drop', 'delete', 'update', 'insert', 'alter']\n    for keyword in dangerous_keywords:\n        if keyword in sql_lower:\n            raise ValueError(f\"æ£€æµ‹åˆ°å±é™© SQL å…³é”®å­—: {keyword}\")\n\n    # ç¡®ä¿æŸ¥è¯¢ä»¥ SELECT å¼€å¤´\n    if not sql_lower.startswith('select'):\n        raise ValueError(\"ä»…å…è®¸æ‰§è¡Œ SELECT æŸ¥è¯¢\")\n\n    return True\n```\n:::\n\n\n## éƒ¨ç½²ä¸å¯è®¿é—®æ€§\n\n### ç¯å¢ƒé…ç½®\n\n```bash\n# ç¯å¢ƒé…ç½®\n# .env æ–‡ä»¶\nMODELSCOPE_API_KEY=your_modelscope_key\n\n# å®‰è£…ä¾èµ–\npip install -r requirements.txt\n\n# æ•°æ®é‡‡é›†\npython download_data.py\n\n# è¿è¡Œåº”ç”¨ç¨‹åº\nstreamlit run app.py\n```\n\n### å¿…éœ€çš„ä¾èµ–é¡¹\n\n```txt\nstreamlit>=1.28.0\npandas>=1.5.0\nplotly>=5.15.0\nduckdb>=0.8.0\nopenai>=1.0.0\npython-dotenv>=1.0.0\nwbgapi>=1.0.0\npycountry>=22.0.0\nnumpy>=1.24.0\n```\n\n## æŠ€æœ¯äº®ç‚¹\n\n### å…³é”®åˆ›æ–°ç‚¹\n\n1. **åŒç•Œé¢æ–¹æ¡ˆ**ï¼šåŒæ—¶æä¾›è§†è§‰å’Œè‡ªç„¶è¯­è¨€è®¿é—®æ•°æ®çš„æ–¹å¼\n2. **AI é©±åŠ¨çš„ SQL ç”Ÿæˆ**ï¼šä½¿ç”¨ç®€å•çš„ä¸­/è‹±æ–‡å³å¯è¿›è¡Œå¤æ‚çš„ç»æµæŸ¥è¯¢\n3. **å®æ—¶æ•°æ®å¤„ç†**ï¼šé«˜æ•ˆçš„ç¼“å­˜å’Œä¼šè¯ç®¡ç†\n4. **å…¨é¢çš„å›½é™…åŒ–**ï¼šçœŸæ­£çš„åŒè¯­æ”¯æŒåŠæœ¬åœ°åŒ–æ•°æ®æ˜¾ç¤º\n5. **ç”Ÿäº§å°±ç»ªçš„éƒ¨ç½²**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–\n\n\n![AI æ‘˜è¦ç”Ÿæˆ](images/2.png){width=\"100%\"}\n\n## ç»æµåˆ†æç¤ºä¾‹\n\n### æ”¯æŒçš„æŸ¥è¯¢ç±»å‹\n\n1. **å¯¹æ¯”åˆ†æ**\n   - \"å¯¹æ¯” 2010 å¹´è‡³ 2020 å¹´ä¸­å›½å’Œæ—¥æœ¬çš„ GDP å¢é•¿\"\n   - \"2023 å¹´å“ªäº›å›½å®¶çš„äººå‡ GDP æœ€é«˜ï¼Ÿ\"\n\n2. **æ—¶åºåˆ†æ**\n   - \"æ˜¾ç¤ºè¿‡å»åå¹´é‡‘ç –å›½å®¶çš„ GDP è¶‹åŠ¿\"\n   - \"2000 å¹´è‡³ 2020 å¹´å°åº¦çš„äººå£å¢é•¿ç‡æ˜¯å¤šå°‘ï¼Ÿ\"\n\n3. **ç»Ÿè®¡æŸ¥è¯¢**\n   - \"è®¡ç®—æ¬§æ´²å›½å®¶çš„å¹³å‡ GDP å¢é•¿ç‡\"\n   - \"æ‰¾å‡º 2022 å¹´äººå‡ GDP è¶…è¿‡ 50,000 ç¾å…ƒçš„å›½å®¶\"\n\n4. **å¤æ‚å¤šå˜é‡åˆ†æ**\n   - \"äºšæ´²å›½å®¶çš„äººå£ä¸ GDP ä¹‹é—´æœ‰ä»€ä¹ˆç›¸å…³æ€§ï¼Ÿ\"\n   - \"åˆ—å‡ºè¿ç»­ 3 å¹´äººå‡ GDP å¢é•¿è¶…è¿‡ 5% çš„å›½å®¶\"\n\n\n## ç»“è®º\n\nè¿™ä¸ª GDP è¶‹åŠ¿çœ‹æ¿ä»£è¡¨äº†ç»æµæ•°æ®åˆ†æçš„åˆ›æ–°æ–¹æ³•ï¼Œå°†ä¼ ç»Ÿçš„è§†è§‰åŒ–æŠ€æœ¯ä¸å°–ç«¯çš„ AI èƒ½åŠ›ç›¸ç»“åˆã€‚è¯¥é¡¹ç›®å±•ç¤ºäº†ï¼š\n\n- **å…ˆè¿›çš„æ•°æ®é›†æˆ**ï¼šé›†æˆä¸–ç•Œé“¶è¡Œ API ä¸å…¨é¢çš„ç»æµæŒ‡æ ‡\n- **è‡ªç„¶è¯­è¨€å¤„ç†**ï¼šAI é©±åŠ¨çš„ SQL ç”Ÿæˆï¼Œå®ç°ä¾¿æ·çš„æ•°æ®æŸ¥è¯¢\n- **ä¸“ä¸šçš„è§†è§‰åŒ–**ï¼šé‡‡ç”¨ä¸€è‡´è®¾è®¡çš„äº¤äº’å¼ Plotly å›¾è¡¨\n- **åŒè¯­æ”¯æŒ**ï¼šå®Œæ•´çš„è‹±/ä¸­æœ¬åœ°åŒ–\n- **ç”Ÿäº§çº§æ¶æ„**ï¼šç¨³å¥çš„é”™è¯¯å¤„ç†ã€ç¼“å­˜å’Œéƒ¨ç½²\n\næ— è®ºæ‚¨æ˜¯ç»æµå­¦å®¶ã€æ•°æ®ç§‘å­¦å®¶è¿˜æ˜¯æ”¿ç­–åˆ†æå¸ˆï¼Œè¯¥åº”ç”¨ç¨‹åºéƒ½å±•ç¤ºäº†ç°ä»£ AI æŠ€æœ¯å¦‚ä½•é€šè¿‡ç›´è§‚çš„ç•Œé¢å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–ï¼Œä½¿å¤æ‚çš„ç»æµæ•°æ®å˜å¾—æ›´åŠ æ˜“äºè·å–å’Œåˆ©ç”¨ã€‚\n\n---\n\n**æŠ€æœ¯æ ˆ**ï¼šStreamlit, DuckDB, Plotly, ModelScope API, World Bank API\n\n**æ•°æ®æº**ï¼šä¸–ç•Œé“¶è¡Œ (2000-2024, 200+ å›½å®¶, 15,000+ æ•°æ®ç‚¹)\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}