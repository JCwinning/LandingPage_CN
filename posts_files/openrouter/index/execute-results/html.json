{
  "hash": "c4adf6b6785a444765841f825f3e04a9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"OpenRouterï¼šå¤š AI æ¨¡å‹çš„ç»Ÿä¸€ API\"\nauthor: \"Tony D\"\ndate: \"2025-11-01\"\ncategories: [AI, API, tutorial]\nimage: \"images.png\"\n\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    code-copy: true\n\nexecute:\n  eval: false\n  warning: false\n---\n\n\n\n\n\n\n\n\n# OpenRouter ç®€ä»‹\n\nOpenRouter æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ API æ¥å£ï¼Œç”¨äºè®¿é—®æ¥è‡ªä¸åŒæä¾›å•†çš„å¤šä¸ª AI æ¨¡å‹ã€‚å¼€å‘äººå‘˜æ— éœ€åˆ†åˆ«ä¸ºæ¯ä¸ª AI æœåŠ¡è¿›è¡Œé›†æˆï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨ OpenRouter çš„å•ä¸€ç«¯ç‚¹è®¿é—®æ¥è‡ª OpenAIã€Anthropicã€Google ç­‰å…¬å¸çš„æ¨¡å‹ã€‚\n\n## OpenRouter å…¥é—¨\n\nä½¿ç”¨ OpenRouter éå¸¸ç®€å•ï¼Œåªéœ€å‡ ä¸ªæ­¥éª¤å³å¯å®Œæˆã€‚è¯¥å¹³å°æ—¨åœ¨æœ€å¤§é™åº¦åœ°å‡å°‘è®¾ç½®æ—¶é—´ï¼ŒåŒæ—¶ä¿æŒå®‰å…¨æœ€ä½³å®è·µã€‚\n\n## 1. åˆ›å»ºæ‚¨çš„ OpenRouter è´¦æˆ·\n\né¦–å…ˆï¼Œè®¿é—® [openrouter.ai](https://openrouter.ai) å¹¶åˆ›å»ºä¸€ä¸ªè´¦æˆ·ã€‚æ³¨å†Œè¿‡ç¨‹éå¸¸ç®€å•ï¼š\n\n1. **æ³¨å†Œ**ï¼šä½¿ç”¨æ‚¨çš„ç”µå­é‚®ç®±æˆ–ç¤¾äº¤ç™»å½•ï¼ˆGoogleã€GitHubï¼‰\n2. **éªŒè¯é‚®ç®±**ï¼šé€šè¿‡éªŒè¯é“¾æ¥ç¡®è®¤æ‚¨çš„ç”µå­é‚®ç®±åœ°å€\n3. **è®¿é—®ä»ªè¡¨æ¿**ï¼šå¯¼èˆªåˆ°ä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥åœ¨é‚£é‡Œæ‰¾åˆ°æ‚¨çš„ API å¯†é’¥\n\n**ğŸ’¡ ä¸“å®¶æç¤º**ï¼šæ‚¨çš„ä»ªè¡¨æ¿æä¾›äº†å®è´µçš„æ´å¯Ÿï¼ŒåŒ…æ‹¬ï¼š\n- ä½¿ç”¨ç»Ÿè®¡å’Œæˆæœ¬è¿½è¸ª\n- æ¨¡å‹æ€§èƒ½æŒ‡æ ‡\n- API å¯†é’¥ç®¡ç†\n- è´¦å•ä¿¡æ¯\n\n## 2. å®‰å…¨çš„ API å¯†é’¥ç®¡ç†\n\nåœ¨ä½¿ç”¨ AI API æ—¶ï¼Œå®‰å…¨è‡³å…³é‡è¦ã€‚åˆ‡å‹¿ç›´æ¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API å¯†é’¥ã€‚ç›¸åï¼Œä½¿ç”¨ç¯å¢ƒå˜æ¥ç¡®ä¿æ‚¨çš„å‡­æ®å®‰å…¨ï¼š\n\n### ä¸ºä»€ä¹ˆç¯å¢ƒå˜é‡å¾ˆé‡è¦\n- **å®‰å…¨æ€§**ï¼šé˜²æ­¢åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­æ„å¤–æ³„éœ²\n- **çµæ´»æ€§**ï¼šå…è®¸ä¸ºå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥\n- **åä½œ**ï¼šå›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨ä¸å…±äº«çš„æƒ…å†µä¸‹ä½¿ç”¨è‡ªå·±çš„å¯†é’¥\n- **éƒ¨ç½²**ï¼šæ˜“äºåœ¨ä¸åŒçš„æ‰˜ç®¡ç¯å¢ƒä¸­è¿›è¡Œç®¡ç†\n\n### è®¾ç½®ç¯å¢ƒå˜é‡\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.env` æ–‡ä»¶ï¼š\n\nOPENROUTER_API_KEY=your_actual_api_key_here\n\n\n\nå®‰è£… `python-dotenv` åº“ä»¥åŠ è½½ç¯å¢ƒå˜é‡ï¼š\n\npip install python-dotenv\n\n\n## 3. æ‚¨çš„ç¬¬ä¸€æ¬¡ API è°ƒç”¨\n\nç°åœ¨æ‚¨å·²ç»è®¾ç½®å¥½äº† API å¯†é’¥ï¼Œè®©æˆ‘ä»¬è¿›è¡Œç¬¬ä¸€æ¬¡ API è°ƒç”¨ã€‚OpenRouter å·§å¦™åœ°ä½¿ç”¨äº†ä¸ OpenAI ç›¸åŒçš„ API æ ¼å¼ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ `openai` Python åº“ â€”â€” åªæ˜¯ä½¿ç”¨ä¸åŒçš„åŸºç«¯ç‚¹ URLã€‚\n\n### äº†è§£æ¶æ„\n\n**ğŸ”§ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„**ï¼šOpenRouter å……å½“æ™ºèƒ½ä»£ç†ï¼Œè´Ÿè´£ï¼š\n1. æ¥æ”¶æ‚¨çš„æ ‡å‡†åŒ– API è¯·æ±‚\n2. å°†å…¶è·¯ç”±åˆ°é€‚å½“çš„ AI æ¨¡å‹æä¾›å•†\n3. å¤„ç†ç‰¹å®šäºæä¾›å•†çš„èº«ä»½éªŒè¯å’Œæ ¼å¼åŒ–\n4. ä»¥ä¸€è‡´çš„æ ¼å¼è¿”å›å“åº”\n5. è¿½è¸ªæ‰€æœ‰æ¨¡å‹çš„ä½¿ç”¨æƒ…å†µå’Œæˆæœ¬\n\n### å¿…éœ€çš„ä¾èµ–é¡¹\n\nåœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å®‰è£…å¿…è¦çš„ Python åŒ…ï¼š\n\n```bash\npip install openai python-dotenv\n```\n\n- **openai**: å®˜æ–¹çš„ OpenAI Python å®¢æˆ·ç«¯ï¼ˆä¸ OpenRouter å…¼å®¹ï¼‰\n- **python-dotenv**: ç”¨äºä» `.env` æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡\n\n### åŸºç¡€æ–‡æœ¬ç”Ÿæˆç¤ºä¾‹\n\n\n::: {.panel-tabset}\n\n## Python (ä½¿ç”¨ OpenAI åŒ…)\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom openai import OpenAI\nimport os\nfrom dotenv import load_dotenv\n\n# ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡\nload_dotenv()\n\n# ä½¿ç”¨ OpenRouter åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯\nclient = OpenAI(\n  base_url=\"https://openrouter.ai/api/v1\",  # OpenRouter çš„ API ç«¯ç‚¹\n  api_key=os.getenv(\"OPENROUTER_API_KEY\"),  # æ‚¨å®‰å…¨çš„ API å¯†é’¥\n)\n\n# ä½¿ç”¨ OpenRouter åˆ›å»ºå¯¹è¯è¡¥å…¨\ncompletion = client.chat.completions.create(\n  extra_headers={\n    \"HTTP-Referer\": \"https://your-site.com\",  # å¯é€‰ï¼šå¸®åŠ© OpenRouter æ”¹è¿›æœåŠ¡\n    \"X-Title\": \"Your Site Name\",             # å¯é€‰ï¼šç”¨äº OpenRouter æ’åçš„ç½‘ç«™åç§°\n  },\n  model=\"openai/gpt-oss-20b:free\",          # ç”¨äºæµ‹è¯•/å¼€å‘çš„å…è´¹æ¨¡å‹\n  messages=[\n    {\n      \"role\": \"user\",\n      \"content\": \"ä½ å¥½ï¼ä½ èƒ½ç”¨ç®€å•çš„æœ¯è¯­è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ OpenRouter å—ï¼Ÿ\"\n    }\n  ],\n  temperature=0.7  # æ§åˆ¶åˆ›é€ åŠ› (0.0 = ç¡®å®šæ€§, 1.0 = éå¸¸æœ‰åˆ›æ„)\n)\n\n# æå–å¹¶æ‰“å°å“åº”\nprint(completion.choices[0].message.content)\n```\n:::\n\n\n\n\n## Python (ä½¿ç”¨ Chatlas åŒ…)\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom chatlas import ChatOpenRouter\nimport os\nfrom dotenv import load_dotenv\n\n# ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡\nload_dotenv()\n\n# ä½¿ç”¨ OpenRouter åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯\nclient = ChatOpenRouter(api_key=os.getenv(\"OPENROUTER_API_KEY\")\n,base_url='https://openrouter.ai/api/v1'\n ,system_prompt=None\n ,model=\"openai/gpt-oss-20b:free\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nresponse=client.chat(\"æ³•å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ\")\n#str(response)\n```\n:::\n\n\n\n## R (ä½¿ç”¨ Ellmer åŒ…)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ellmer)\nlibrary(dotenv)\nload_dot_env(file = \".env\")\n\nchat <- chat_openrouter(\n  system_prompt = NULL,\n  api_key = Sys.getenv(\"OPENROUTER_API_KEY\"),\n \n  model = \"openai/gpt-oss-20b:free\",\n  echo = \"none\"\n)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchat$chat(\"ç»™æˆ‘è®²ä¸‰ä¸ªå…³äºç»Ÿè®¡å­¦å®¶çš„ç¬‘è¯\")\n```\n:::\n\n\n\n:::\n\n\n**æ ¸å¿ƒç»„ä»¶è¯´æ˜ï¼š**\n\n- **`base_url`**ï¼šæŒ‡å‘ OpenRouter çš„ API è€Œé OpenAI çš„\n- **`model`**ï¼šä½¿ç”¨ OpenRouter çš„æ¨¡å‹å‘½åæ ¼å¼ (`æä¾›å•†/æ¨¡å‹åç§°`)\n- **`extra_headers`**ï¼šå¯é€‰ï¼Œä½†å»ºè®®ç”¨äº OpenRouter çš„åˆ†æ\n- **`temperature`**ï¼šæ§åˆ¶å“åº”çš„åˆ›é€ åŠ›ï¼ˆèŒƒå›´ 0.0-2.0ï¼‰\n- **`messages`**ï¼šæ ‡å‡†çš„èŠå¤©æ ¼å¼ï¼Œé‡‡ç”¨åŸºäºè§’è‰²çš„å¯¹è¯ç»“æ„\n\n**ğŸ’¡ æ¨¡å‹é€‰æ‹©å»ºè®®ï¼š**\n- **å…è´¹æ¨¡å‹**ï¼šéå¸¸é€‚åˆå¼€å‘é˜¶æ®µï¼ˆä»¥ `*free` ç»“å°¾ï¼‰\n- **ç»æµå‹æ¨¡å‹**ï¼šé€‚åˆç”Ÿäº§ç¯å¢ƒçš„æˆæœ¬æ•ˆç›Šæ¨¡å‹ï¼ˆä»¥ `*:budget` ç»“å°¾ï¼‰\n- **é«˜çº§æ¨¡å‹**ï¼šæœ€ä½³æ€§èƒ½ï¼ˆ`*`ã€`*:pro`ã€`*:latest`ï¼‰\n- **ä¸“ä¸šæ¨¡å‹**ï¼šé’ˆå¯¹ç‰¹å®šä»»åŠ¡ä¼˜åŒ–çš„æ¨¡å‹ï¼ˆç¼–ç¨‹ã€æ•°å­¦ã€åˆ›æ„å†™ä½œï¼‰\n\n## 4. æŒæ¡ç³»ç»Ÿæç¤ºè¯ (System Prompts)\n\nç³»ç»Ÿæç¤ºè¯æ˜¯å¡‘é€  AI è¡Œä¸ºã€ä¸ªæ€§å’Œå›å¤é£æ ¼çš„å¼ºå¤§å·¥å…·ã€‚å®ƒä»¬è®¾ç½®äº†æ•´ä¸ªå¯¹è¯çš„ä¸Šä¸‹æ–‡å’Œè§„åˆ™ï¼Œåœ¨å¯¹è¯æµä¸­å‡ºç°åœ¨ç”¨æˆ·æ¶ˆæ¯ä¹‹å‰ã€‚\n\n### ä»€ä¹ˆæ˜¯ç³»ç»Ÿæç¤ºè¯ï¼Ÿ\n\nç³»ç»Ÿæç¤ºè¯å……å½“**å…ƒæŒ‡ä»¤**ï¼ŒæŒ‡å¯¼ AI åœ¨æ•´ä¸ªå¯¹è¯ä¸­åº”å¦‚ä½•ååº”ã€‚å®ƒä»¬æœ€å…ˆè¢«å¤„ç†ï¼Œå¹¶å½±å“æ‰€æœ‰åç»­çš„äº¤äº’ã€‚\n\n### ä¸ºä»€ä¹ˆç³»ç»Ÿæç¤ºè¯å¾ˆé‡è¦\n\n- **ä¸€è‡´çš„è¡Œä¸º**ï¼šç¡®ä¿ AI åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒæ‰€éœ€çš„ä¸ªæ€§\n- **è¾“å‡ºæ ¼å¼**ï¼šè§„å®šå“åº”ç»“æ„ï¼ˆJSONã€Markdownã€ä»£ç å—ï¼‰\n- **å®‰å…¨çº¦æŸ**ï¼šè®¾ç½®å›å¤çš„è¾¹ç•Œå’Œé™åˆ¶\n- **ä¸Šä¸‹æ–‡è®¾ç½®**ï¼šæä¾›èƒŒæ™¯ä¿¡æ¯ä»¥è·å¾—æ›´å¥½çš„å›å¤\n- **ä»»åŠ¡ä¸“é—¨åŒ–**ï¼šé’ˆå¯¹ç‰¹å®šç”¨ä¾‹ä¼˜åŒ– AI\n\n### æœ‰æ•ˆçš„ç³»ç»Ÿæç¤ºè¯ç¤ºä¾‹\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# å¸¦æœ‰ç³»ç»Ÿæç¤ºè¯çš„ç¤ºä¾‹\ncompletion = client.chat.completions.create(\n  model=\"openai/gpt-oss-20b:free\",\n  messages=[\n    {\n      \"role\": \"system\",\n      \"content\": \"ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„ AI åŠ©æ‰‹ï¼Œå¯ä»¥ç”¨ç®€å•çš„æœ¯è¯­è§£é‡ŠæŠ€æœ¯æ¦‚å¿µã€‚å§‹ç»ˆä¿æŒå‹å¥½ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨ç±»æ¯”ï¼Œä¿æŒç®€å•ã€‚\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"LLM æ¨¡å‹ä¸­çš„æ¸©åº¦ (temperature) æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\"\n    }\n  ],\n  temperature=0.7\n)\n\nprint(completion.choices[0].message.content)\n```\n:::\n\n\nå¸¸è§çš„ç³»ç»Ÿæç¤ºè¯æ¨¡å¼ï¼š\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# ä¸åŒçš„ç³»ç»Ÿæç¤ºè¯ç¤ºä¾‹\nsystem_prompts = {\n    \"coding_assistant\": \"ä½ æ˜¯ä¸€ä¸ªä¸“å®¶çº§ç¨‹åºå‘˜ã€‚æä¾›æ•´æ´ã€æ³¨é‡Šè‰¯å¥½çš„ä»£ç è§£å†³æ–¹æ¡ˆï¼Œå¹¶è§£é‡Šä½ çš„æ¨ç†ã€‚\",\n    \"creative_writer\": \"ä½ æ˜¯ä¸€ä¸ªåˆ›æ„æ•…äº‹è®²è¿°è€…ã€‚ç¼–å†™å…·æœ‰ç”ŸåŠ¨æè¿°å’Œå¼•äººå…¥èƒœè§’è‰²çš„åŠ¨äººå™è¿°ã€‚\",\n    \"data_analyst\": \"ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆã€‚æ ¹æ®æ•°æ®æä¾›è§è§£ï¼Œå»ºè®®å¯è§†åŒ–æ–¹å¼ï¼Œå¹¶æ¸…æ™°åœ°è§£é‡Šç»Ÿè®¡æ¦‚å¿µã€‚\",\n    \"tutor\": \"ä½ æ˜¯ä¸€ä¸ªè€å¿ƒçš„å¯¼å¸ˆã€‚å°†å¤æ‚çš„ä¸»é¢˜åˆ†è§£ä¸ºç®€å•çš„æ­¥éª¤å¹¶æä¾›é¼“åŠ±æ€§çš„åé¦ˆã€‚\"\n}\n\ndef chat_with_persona(persona, user_message):\n    completion = client.chat.completions.create(\n        model=\"openai/gpt-oss-20b:free\",\n        messages=[\n            {\"role\": \"system\", \"content\": system_prompts[persona]},\n            {\"role\": \"user\", \"content\": user_message}\n        ],\n        temperature=0.7\n    )\n    return completion.choices[0].message.content\n\n# ç¤ºä¾‹ç”¨æ³•\n#response = chat_with_persona(\"coding_assistant\", \"å¦‚ä½•ç”¨ Python åè½¬å­—ç¬¦ä¸²ï¼Ÿ\")\n#print(response)\n```\n:::\n\n\n\n## 5. æµå¼å“åº”ï¼šå®æ—¶ AI äº¤äº’\n\næµå¼ä¼ è¾“ (Streaming) æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„åˆ©å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨èŠå¤©åº”ç”¨å’Œäº¤äº’å¼å·¥å…·ä¸­ã€‚æµå¼ä¼ è¾“ä¸æ˜¯ç­‰å¾…å®Œæ•´çš„å“åº”ï¼Œè€Œæ˜¯åœ¨ç”Ÿæˆå†…å®¹æ—¶ç«‹å³äº¤ä»˜ï¼Œä»è€Œåˆ›é€ è‡ªç„¶ä¸”å¼•äººå…¥èƒœçš„å¯¹è¯ã€‚\n\n### ä¸ºä»€ä¹ˆæµå¼ä¼ è¾“å¾ˆé‡è¦\n\n**ğŸš€ ç”¨æˆ·ä½“éªŒä¼˜åŠ¿ï¼š**\n- **ç«‹å³åé¦ˆ**ï¼šç”¨æˆ·èƒ½ç«‹å³çœ‹åˆ°å“åº”å¼€å§‹ç”Ÿæˆ\n- **é™ä½æ„ŸçŸ¥å»¶è¿Ÿ**ï¼šå†…å®¹åœ¨ç”Ÿæˆæ—¶å³åˆ»æ˜¾ç¤º\n- **è‡ªç„¶çš„å¯¹è¯æµ**ï¼šæ¨¡ä»¿äººç±»è¯´è¯çš„æ¨¡å¼\n- **è¿›åº¦æŒ‡ç¤º**ï¼šç”¨æˆ·çŸ¥é“ AI æ­£åœ¨å·¥ä½œ\n- **åŠæ—©ç»ˆæ­¢**ï¼šå¦‚æœéœ€è¦ï¼Œç”¨æˆ·å¯ä»¥åœæ­¢è¿‡é•¿çš„å›å¤\n\n**âš¡ æŠ€æœ¯ä¼˜åŠ¿ï¼š**\n- **æ›´ä½çš„å†…å­˜å ç”¨**ï¼šæ— éœ€ç¼“å†²å®Œæ•´å“åº”\n- **æ›´å¿«çš„é¦–å­—èŠ‚æ—¶é—´**ï¼šå†…å®¹ç«‹å³å¼€å§‹æµåŠ¨\n- **æ›´å¥½çš„é”™è¯¯å¤„ç†**ï¼šåœ¨è¿‡ç¨‹ä¸­æ›´æ—©å‘ç°é—®é¢˜\n- **èµ„æºæ•ˆç‡**ï¼šå¢é‡å¤„ç†æ•°æ®\n\n### åœ¨ OpenRouter ä¸­å®ç°æµå¼ä¼ è¾“\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯ï¼ˆå¦‚æœå°šæœªå®Œæˆï¼‰\nfrom openai import OpenAI\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\nclient = OpenAI(\n  base_url=\"https://openrouter.ai/api/v1\",\n  api_key=os.getenv(\"OPENROUTER_API_KEY\"),\n)\n\ndef stream_response(model, message):\n    stream = client.chat.completions.create(\n        model=model,\n        messages=[{\"role\": \"user\", \"content\": message}],\n        stream=True\n    )\n\n    for chunk in stream:\n        if chunk.choices[0].delta.content is not None:\n            print(chunk.choices[0].delta.content, end='', flush=True)\n\n# æµå¼ä¼ è¾“ç¤ºä¾‹\nprint(\"æ­£åœ¨æµå¼ä¼ è¾“å“åº”ï¼š\")\nstream_response(\"openai/gpt-oss-20b:free\", \"è¯·ç»™æˆ‘è®²ä¸€ä¸ªå…³äº AI çš„çŸ­ç¯‡æ•…äº‹\")\nprint()  # æµå¼ä¼ è¾“ç»“æŸåæ·»åŠ æ¢è¡Œ\n```\n:::\n\n\n\n\n\n### 6. æ–‡å­—è½¬å›¾åƒ (Text to Image)\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom openai import OpenAI\nimport base64\nimport datetime\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# | eval: false\nfrom openai import OpenAI\nimport os\nfrom dotenv import load_dotenv\n\n# ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡\nload_dotenv()\n\n# ä½¿ç”¨ OpenRouter åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯\nclient = OpenAI(\n    base_url=\"https://openrouter.ai/api/v1\",\n    api_key=os.getenv(\"OPENROUTER_API_KEY\"),\n)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# å›¾åƒç”Ÿæˆè¯·æ±‚\nresponse = client.chat.completions.create(\n    extra_headers={\n        \"HTTP-Referer\": \"www.tonydotdev.com\",\n        \"X-Title\": \"TT_AI_blog\",\n    },\n    model=\"google/gemini-2.5-flash-image\",\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": \"ç”Ÿæˆä¸€å¼ å®é™ä¸”å†™å®çš„æ—¥å‡ºé›ªå±±é£æ™¯å›¾ã€‚\",\n        }\n    ],\n    modalities=[\"image\", \"text\"],\n    #image_size=\"1024x1024\",\n)\n```\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport base64\nimport datetime\n# æå–æ¶ˆæ¯\nmessage = response.choices[0].message\n\n# å¤„ç†å›¾åƒè¾“å‡ºï¼ˆbase64 å­—ç¬¦ä¸²ä½äº \"data:image/png;base64,...\" ä¸­ï¼‰\nif message.images:\n    data_url = message.images[0][\"image_url\"][\"url\"]\n\n    # å¦‚æœå­˜åœ¨å‰ç¼€åˆ™å°†å…¶å‰¥ç¦»\n    if data_url.startswith(\"data:image\"):\n        _, base64_data = data_url.split(\",\", 1)\n    else:\n        base64_data = data_url\n\n    # è§£ç å¹¶ä¿å­˜ä¸º PNG\n    image_bytes = base64.b64decode(base64_data)\n    current_time = datetime.datetime.now().strftime(\"%H%M\")\n    output_file = f\"text_image_gemini_25_openrouter_{current_time}.png\"\n    with open(output_file, \"wb\") as f:\n        f.write(image_bytes)\n\n    print(f\"âœ… å›¾åƒå·²ä¿å­˜ä¸º {output_file}\")\nelse:\n    print(\"âŒ å“åº”ä¸­æœªè¿”å›å›¾åƒ\")\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom IPython.display import Image, display\n\ndisplay(Image(filename=\"text_image_gemini_25_openrouter_1352.png\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<IPython.core.display.Image object>\n```\n\n\n:::\n:::\n\n\n\n### 7. å›¾åƒè½¬æ–‡å­— (Image to Text)\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport base64\n\n# å°†æœ¬åœ°å›¾åƒè½¬æ¢ä¸º data URL\nwith open(\"text_image_gemini_25_openrouter_1352.png\", \"rb\") as image_file:\n    base64_image = base64.b64encode(image_file.read()).decode('utf-8')\n    data_url = f\"data:image/png;base64,{base64_image}\"\n\ncompletion = client.chat.completions.create(\n  extra_headers={\n    \"HTTP-Referer\": \"<æ‚¨çš„ç½‘ç«™URL>\", # å¯é€‰ï¼šOpenRouter æ’åç”¨çš„ç½‘ç«™ URL\n    \"X-Title\": \"<æ‚¨çš„ç½‘ç«™åç§°>\", # å¯é€‰ï¼šOpenRouter æ’åç”¨çš„ç½‘ç«™åç§°\n  },\n  extra_body={},\n  model=\"nvidia/nemotron-nano-12b-v2-vl:free\",\n  messages=[\n              {\n                \"role\": \"user\",\n                \"content\": [\n                  {\n                    \"type\": \"text\",\n                    \"text\": \"è¿™å¼ å›¾ç‰‡é‡Œæœ‰ä»€ä¹ˆï¼Ÿ\"\n                  },\n                  {\n                    \"type\": \"image_url\",\n                    \"image_url\": {\n                      \"url\": data_url\n                    }\n                  }\n                ]\n              }\n            ]\n)\nprint(completion.choices[0].message.content)\n```\n:::\n\n\n\n\n### 8. æ–‡å­—ä¸å›¾åƒç»“åˆç”Ÿæˆå›¾åƒ (Text & Image to Image)\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# | eval: false\nimport base64\n\n# å°†ä¹‹å‰ç”Ÿæˆçš„å›¾åƒè½¬æ¢ä¸º base64\nwith open(\"text_image_gemini_25_openrouter_1352.png\", \"rb\") as image_file:\n    base64_image = base64.b64encode(image_file.read()).decode(\"utf-8\")\n\nresponse = client.chat.completions.create(\n    extra_headers={\n        \"HTTP-Referer\": \"www.tonydotdev.com\",\n        \"X-Title\": \"TT_AI_blog\",\n    },\n    model=\"google/gemini-2.5-flash-image\",\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": [\n                {\n                    \"type\": \"text\",\n                    \"text\": \"å°†è¿™å¼ å›¾ç‰‡è½¬æ¢ä¸ºæ—¥è½ç‰ˆæœ¬ï¼Œä½¿ç”¨æ›´æ¸©æš–çš„è‰²å½©å’Œé‡‘è‰²çš„å…‰çº¿ã€‚åœ¨å‰æ™¯ä¸­å¢åŠ ä¸€ä¸ªæ­£åœ¨æ»‘é›ªçš„äººã€‚\",\n                },\n                {\n                    \"type\": \"image_url\",\n                    \"image_url\": {\"url\": f\"data:image/png;base64,{base64_image}\"},\n                },\n            ],\n        }\n    ],\n    modalities=[\"image\", \"text\"],\n    # image_size=\"1024x1024\",\n)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport base64\nimport datetime\n# æå–æ¶ˆæ¯\nmessage = response.choices[0].message\n\n# å¤„ç†å›¾åƒè¾“å‡ºï¼ˆbase64 å­—ç¬¦ä¸²ä½äº \"data:image/png;base64,...\" ä¸­ï¼‰\nif message.images:\n    data_url = message.images[0][\"image_url\"][\"url\"]\n\n    # å¦‚æœå­˜åœ¨å‰ç¼€åˆ™å°†å…¶å‰¥ç¦»\n    if data_url.startswith(\"data:image\"):\n        _, base64_data = data_url.split(\",\", 1)\n    else:\n        base64_data = data_url\n\n    # è§£ç å¹¶ä¿å­˜ä¸º PNG\n    image_bytes = base64.b64decode(base64_data)\n    current_time = datetime.datetime.now().strftime(\"%H%M\")\n    output_file = f\"text_image_gemini_25_openrouter_{current_time}.png\"\n    with open(output_file, \"wb\") as f:\n        f.write(image_bytes)\n\n    print(f\"âœ… å›¾åƒå·²ä¿å­˜ä¸º {output_file}\")\nelse:\n    print(\"âŒ å“åº”ä¸­æœªè¿”å›å›¾åƒ\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom IPython.display import Image, display\n\ndisplay(Image(filename=\"text_image_gemini_25_openrouter_1405.png\"))\n```\n:::\n\n\n### 8 Embedding\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom openai import OpenAI\n## 8. æ–‡æœ¬åµŒå…¥ (Embedding)\n```\n:::\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom openai import OpenAI\nimport os\nfrom dotenv import load_dotenv\n\n# ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡\nload_dotenv()\n\n# ä½¿ç”¨ OpenRouter åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯\nclient = OpenAI(\n    base_url=\"https://openrouter.ai/api/v1\",\n    api_key=os.getenv(\"OPENROUTER_API_KEY\"),\n)\n\n\nembedding = client.embeddings.create(\n  extra_headers={\n    \"HTTP-Referer\": \"<YOUR_SITE_URL>\", # å¯é€‰ï¼šOpenRouter æ’åç”¨çš„ç½‘ç«™ URL\n    \"X-Title\": \"<YOUR_SITE_NAME>\", # å¯é€‰ï¼šOpenRouter æ’åç”¨çš„ç½‘ç«™åç§°\n  },\n  model=\"thenlper/gte-base\",\n  input=\"I can\",\n  encoding_format=\"float\"\n)\n\n#print(embedding.data[0].embedding) \n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nlen(embedding.data[0].embedding)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nprint(embedding.data[0].embedding[:5])  # æ‰“å°å‰ 5 ä¸ªç»´åº¦\n```\n:::\n\n\n\n\n## æˆæœ¬ç®¡ç†ï¼šä¼˜åŒ–æ‚¨çš„ AI æ”¯å‡º\n\nOpenRouter æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å…¶é€æ˜çš„å®šä»·æ¨¡å‹å’Œæˆæœ¬ç®¡ç†èƒ½åŠ›ã€‚å¯¹äºç”Ÿäº§çº§ AI åº”ç”¨æ¥è¯´ï¼Œç†è§£å’Œç®¡ç†æˆæœ¬è‡³å…³é‡è¦ã€‚\n\n## ä¸ºä»€ä¹ˆæˆæœ¬ç®¡ç†å¾ˆé‡è¦\n\n**ğŸ’° è´¢åŠ¡è§„åˆ’ï¼š**\n- å¯é¢„æµ‹çš„æ¯æœˆæ”¯å‡º\n- ä¸ºä¸åŒç”¨ä¾‹åˆ†é…é¢„ç®—\n- AI åŠŸèƒ½çš„ ROI åˆ†æ\n- æ¯ä¸ªç”¨æˆ·çš„æˆæœ¬è¿½è¸ª\n\n**ğŸ” æŠ€æœ¯ä¼˜åŒ–ï¼š**\n- æ ¹æ®æˆæœ¬/æ€§èƒ½æ¯”é€‰æ‹©æ¨¡å‹\n- æç¤ºè¯å·¥ç¨‹ä»¥å‡å°‘ Token ä½¿ç”¨\n- é‡å¤è¯·æ±‚çš„ç¼“å­˜ç­–ç•¥\n- æé«˜æ•ˆç‡çš„æ‰¹é‡å¤„ç†\n\n## å®æ—¶æˆæœ¬è¿½è¸ª\n\nOpenRouter æä¾›äº†é€šè¿‡ç¼–ç¨‹æ–¹å¼è®¿é—®æ‰€æœ‰æ¨¡å‹å½“å‰å®šä»·çš„æ¥å£ï¼š\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯ï¼ˆå¦‚æœå°šæœªå®Œæˆï¼‰\nfrom openai import OpenAI\nimport os\nfrom dotenv import load_dotenv\nimport pandas as pd\n\nload_dotenv()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTrue\n```\n\n\n:::\n\n```{.python .cell-code}\nclient = OpenAI(\n  base_url=\"https://openrouter.ai/api/v1\",\n  api_key=os.getenv(\"OPENROUTER_API_KEY\"),\n)\n\ndef get_model_pricing():\n    models_list = client.models.list()\n    pricing_data = []\n\n    for model in models_list.data:\n        name = model.id\n        pricing = model.pricing\n\n        # è·å–æ¨¡å‹å…ƒæ•°æ®\n        context_length = getattr(model, 'context_length', None)\n        description = getattr(model, 'description', '')\n\n        # è·å–åˆ›å»ºæ—¥æœŸå¹¶è½¬æ¢ä¸ºå¯è¯»æ ¼å¼\n        created_timestamp = getattr(model, 'created', None)\n        if created_timestamp:\n            import datetime\n            created_date = datetime.datetime.fromtimestamp(created_timestamp).strftime('%Y-%m-%d')\n        else:\n            created_date = None\n\n        # ä»æ¨¡å‹åç§°ä¸­æå–å…¬å¸ï¼ˆ'/' å‰çš„ç¬¬ä¸€éƒ¨åˆ†ï¼‰\n        company = name.split('/')[0] if '/' in name else 'Unknown'\n\n        # å°†æ¯ä¸ª Token çš„ä»·æ ¼è½¬æ¢ä¸ºæ¯ 100 ä¸‡ä¸ª Token çš„æˆæœ¬\n        prompt_cost = float(pricing.get('prompt', 0)) * 1000000 if pricing and pricing.get('prompt') else 0\n        completion_cost = float(pricing.get('completion', 0)) * 1000000 if pricing and pricing.get('completion') else 0\n        request_cost = float(pricing.get('request', 0)) * 1000000 if pricing and pricing.get('request') else 0\n        image_cost = float(pricing.get('image', 0)) * 1000000 if pricing and pricing.get('image') else 0\n\n        pricing_data.append({\n            'æ¨¡å‹': name,\n            'å…¬å¸': company,\n            'æè¿°': description,\n            'ä¸Šä¸‹æ–‡é•¿åº¦': context_length,\n            'åˆ›å»ºæ—¥æœŸ': created_date,\n            'æç¤ºè¯æˆæœ¬_æ¯1M': prompt_cost,\n            'è¡¥å…¨æˆæœ¬_æ¯1M': completion_cost,\n            'è¯·æ±‚æˆæœ¬_æ¯1M': request_cost,\n            'å›¾åƒæˆæœ¬_æ¯1M': image_cost\n        })\n\n    # åˆ›å»º Pandas DataFrame\n    df = pd.DataFrame(pricing_data)\n\n    # æŒ‰å…¬å¸ã€æ¨¡å‹åç§°æ’åºï¼Œæ–¹ä¾¿æ•´ç†\n    df = df.sort_values(['å…¬å¸', 'æ¨¡å‹']).reset_index(drop=True)\n\n    return df\n\n# è·å–ä»·æ ¼ DataFrameï¼ˆå…¨é‡æ¨¡å‹ä»¥åŠä»…ä»˜è´¹æ¨¡å‹ï¼‰\nall_models_df = get_model_pricing()\n```\n:::\n\n\n\n\n\n#### æœ€æ˜‚è´µçš„æ¨¡å‹\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport panel as pn\n\n\ndf = all_models_df[\n    [\n        \"æ¨¡å‹\",\n        \"ä¸Šä¸‹æ–‡é•¿åº¦\",\n        \"åˆ›å»ºæ—¥æœŸ\",\n        \"æç¤ºè¯æˆæœ¬_æ¯1M\",\n        \"è¡¥å…¨æˆæœ¬_æ¯1M\",\n    ]\n].sort_values(\"æç¤ºè¯æˆæœ¬_æ¯1M\", ascending=False)\n\n# åˆ›å»ºä¸€ä¸ªå¸¦åˆ†é¡µçš„è¡¨æ ¼\npn.extension(\"tabulator\")\ntable = pn.widgets.Tabulator(df, pagination=\"local\", page_size=10, show_index=False)\ntable\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTabulator(page_size=10, pagination='local', show_index=False, value=              ...)\n```\n\n\n:::\n:::\n\n\n\n## æœ€ä½³å®è·µï¼šç”Ÿäº§å°±ç»ªçš„ AI å¼€å‘\n\néµå¾ªè¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©æ‚¨ä½¿ç”¨ OpenRouter æ„å»ºç¨³å¥ã€å®‰å…¨ä¸”é«˜æ•ˆçš„ AI åº”ç”¨ç¨‹åºã€‚\n\n## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ\n\n### 1. API å¯†é’¥ç®¡ç†\n- **åˆ‡å‹¿ç¡¬ç¼–ç  API å¯†é’¥**åœ¨æºä»£ç æˆ–é…ç½®æ–‡ä»¶ä¸­\n- **ä½¿ç”¨ç¯å¢ƒå˜é‡**æˆ–ç§˜å¯†ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ AWS Secrets Managerã€Azure Key Vaultï¼‰\n- **å®šæœŸè½®æ¢ API å¯†é’¥**å¹¶å®æ–½å¯†é’¥è½®æ¢ç­–ç•¥\n- **ä½¿ç”¨ä¸åŒçš„å¯†é’¥**ç”¨äºå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒ\n- **å°† .env æ·»åŠ åˆ° .gitignore** â€”â€” æ°¸è¿œä¸è¦å°†å‡­æ®æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­\n\n### 2. è¾“å…¥éªŒè¯ä¸æ¸…ç†\n- **åœ¨å‘é€åˆ° AI æ¨¡å‹ä¹‹å‰éªŒè¯ç”¨æˆ·è¾“å…¥**\n- **æ¸…ç†æç¤ºè¯**ä»¥é˜²æ­¢æç¤ºè¯æ³¨å…¥æ”»å‡»\n- **å®æ–½é€Ÿç‡é™åˆ¶**ä»¥é˜²æ­¢æ»¥ç”¨\n- **è®°å½•å¹¶ç›‘æ§**å¼‚å¸¸æ´»åŠ¨æ¨¡å¼\n\n## âš¡ æ€§èƒ½æœ€ä½³å®è·µ\n\n### 3. æ¨¡å‹é€‰æ‹©ç­–ç•¥\n- **ä¸ºæ‚¨çš„ç”¨ä¾‹é€‰æ‹©åˆé€‚çš„æ¨¡å‹** â€”â€” å¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æœ€æ˜‚è´µçš„æ¨¡å‹\n- **é’ˆå¯¹æ‚¨çš„ç‰¹å®šç”¨ä¾‹è¿›è¡Œæ¨¡å‹åŸºå‡†æµ‹è¯•**\n- **ä½¿ç”¨å…è´¹æ¨¡å‹**è¿›è¡Œå¼€å‘å’Œæµ‹è¯•\n- **è€ƒè™‘ä¸“ç”¨æ¨¡å‹**å¤„ç†ç‰¹å®šä»»åŠ¡ï¼ˆç¼–ç¨‹ã€æ•°å­¦ã€åˆ›æ„å†™ä½œï¼‰\n\n### 4. ä¼˜åŒ–æŠ€æœ¯\n- **å®æ–½ç¼“å­˜**ä»¥å‡å°‘é‡å¤è¯·æ±‚çš„æˆæœ¬\n- **ä½¿ç”¨æµå¼ä¼ è¾“**ä»¥è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ\n- **åœ¨é€‚å½“æƒ…å†µä¸‹è¿›è¡Œæ‰¹é‡è¯·æ±‚**ä»¥æé«˜æ•ˆç‡\n- **ä¼˜åŒ–æç¤ºè¯** â€”â€” ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯å¯ä»¥å‡å°‘ Token ä½¿ç”¨å¹¶æ”¹å–„ç»“æœ\n\n## ğŸ›¡ï¸ å¯é æ€§æœ€ä½³å®è·µ\n\n### 5. é”™è¯¯å¤„ç†ä¸å®¹é”™\n- **å®æ–½å…¨é¢çš„é”™è¯¯å¤„ç†** â€”â€” æ¨¡å‹å¯èƒ½ä¼šä¸å¯ç”¨æˆ–å—åˆ°é€Ÿç‡é™åˆ¶\n- **ä½¿ç”¨å¤‡ç”¨æ¨¡å‹** â€”â€” ç¡®ä¿å³ä½¿ä¸€ä¸ªæ¨¡å‹å®•æœºï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºä»èƒ½æ­£å¸¸è¿è¡Œ\n- **å®æ–½å¸¦æœ‰æŒ‡æ•°é€€é¿çš„é‡è¯•é€»è¾‘**\n- **ç›‘æ§å“åº”æ—¶é—´**å¹¶è®¾ç½®é€‚å½“çš„è¶…æ—¶\n\n### 6. ç›‘æ§ä¸åˆ†æ\n- **ç›‘æ§ä½¿ç”¨æƒ…å†µ** â€”â€” è¿½è¸ªæˆæœ¬å¹¶è®¾ç½®é™åˆ¶\n- **è¿½è¸ªæ€§èƒ½æŒ‡æ ‡**ï¼ˆå»¶è¿Ÿã€æˆåŠŸç‡ã€é”™è¯¯ç‡ï¼‰\n- **ä¸ºå¼‚å¸¸æ´»åŠ¨æ¨¡å¼è®¾ç½®å‘Šè­¦**\n- **åˆ›å»ºå®æ—¶ç›‘æ§ä»ªè¡¨æ¿**\n\n## ğŸ“Š æˆæœ¬ç®¡ç†æœ€ä½³å®è·µ\n\n### 7. é¢„ç®—æ§åˆ¶\n- **åœ¨ OpenRouter ä»ªè¡¨æ¿ä¸­è®¾ç½®æ”¯å‡ºé™åˆ¶**å’Œå‘Šè­¦\n- **ä¸ºéå…³é”®ä»»åŠ¡ä½¿ç”¨é«˜æ€§ä»·æ¯”æ¨¡å‹**\n- **å®æ–½ Token è®¡æ•°**ä»¥åœ¨è¯·æ±‚å‰ä¼°ç®—æˆæœ¬\n- **å®šæœŸæŸ¥çœ‹ä½¿ç”¨æŠ¥å‘Š**ä»¥è¯†åˆ«ä¼˜åŒ–æœºä¼š\n\n## ç»“è®ºï¼šæ„å»º AI åº”ç”¨çš„æœªæ¥\n\nOpenRouter ä»£è¡¨äº†å¼€å‘äººå‘˜ä¸ AI æ¨¡å‹äº¤äº’æ–¹å¼çš„èŒƒå¼è½¬å˜ã€‚é€šè¿‡æä¾›è®¿é—®ä¸–ç•Œä¸Šæœ€å…ˆè¿› AI æ¨¡å‹çš„ç»Ÿä¸€ã€å¯é ä¸”æå…·æˆæœ¬æ•ˆç›Šçš„ç½‘å…³ï¼ŒOpenRouter è®©å¼€å‘äººå‘˜èƒ½å¤Ÿä¸“æ³¨äºåˆ›é€ ä»·å€¼ï¼Œè€Œä¸æ˜¯å¤„ç†å¤æ‚çš„åŸºç¡€è®¾æ–½ã€‚\n\n\n\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}